<project name="pt-modules" default="build-jar">
  <!-- $Id$
       This file is used by ant to build modules that include a subset of Ptolemy II.
    -->

  <!-- Ant properties. Alphabetize, please. -->
  <property name="jar-name" value="jar"/>
  <property name="projectsPath" value="../projects"/>
  <property name="ptPath" value="../.."/>
  <property name="pt-projects" value=""/>
  <property name="pt-projects-classpath" value=""/>


  <!-- Ant targets. Alphabetize, please. Run "ant -p" to see the descriptions. -->
  <target name="clean"
	  description="Delete the jars/ directory.">
    <delete dir="jars"/>
  </target>

  <target name="build-all"
	  depends="init,clean"
	  description="Clean, then build all the jar files.">
    <antcall target="ptolemy-core.jar"/>
    <antcall target="ptolemy-moml.jar"/>
    <antcall target="ptolemy-sdf.jar"/>
    <antcall target="ptolemy-lib.jar"/>
    <antcall target="ptolemy-de.jar"/>
    <antcall target="ptolemy-ddf.jar"/>
    <antcall target="ptolemy-sr.jar"/>
    <antcall target="ptolemy-fsm.jar"/>
    <antcall target="ptolemy-ptera.jar"/>
  </target>


  <target name="build-jar"
	  depends="init"
	  description="Build an individual jar file.">
    <delete dir="${jar-name}"/>
    <copy todir="${jar-name}/src">
      <linkedprojectfileset ptPath="${ptPath}" projectPathsPrefix="${projectsPath}"
			    projectPaths="${pt-projects}"/>
    </copy>
    <javac srcdir="${jar-name}/src" classpath="${pt-projects-classpath}" includeantruntime="false"/>
    <jar destfile="jars/${jar-name}.jar" basedir="${jar-name}/src"
	 excludes="**/*.java"
	 />
    <delete dir="${jar-name}"/>
  </target>

  <target name="init"
	  description="Build a Java class used by ant to handle linked projects.">
    <javac srcdir="pt-antext/src" destdir="pt-antext/bin" includeantruntime="true"/>
    <typedef
       name="linkedprojectfileset"
       classname="org.ptolemy.antext.LinkedProjectFileSet"
       classpath="pt-antext/bin"/>
    <mkdir dir="jars"/>
  </target>
  
  <target name="ptolemy-core.jar"
	  description="A jar file containing the pt-kore and pt-akore projects.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-kore;pt-akore"/>
      <param name="jar-name" value="ptolemy-core"/>
    </antcall>
  </target>

  <target name="ptolemy-moml.jar"
	  description="A jar file containing the pt-moml and pt-momlapp projects.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-moml;pt-momlapp"/>
      <param name="jar-name" value="ptolemy-moml"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-lib.jar"
	  description="A jar file containing the pt-lib project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-junit;pt-lib"/>
      <param name="jar-name" value="ptolemy-lib"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar;jars/ptolemy-sdf.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-de.jar"
	  description="A jar file containing the pt-de project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-de"/>
      <param name="jar-name" value="ptolemy-de"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-ddf.jar"
	  description="A jar file containing the pt-ddf project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-ddf"/>
      <param name="jar-name" value="ptolemy-ddf"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-fsm.jar"
	  description="A jar file containing the pt-fsm project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-fsm"/>
      <param name="jar-name" value="ptolemy-fsm"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar;jars/ptolemy-sdf.jar;jars/ptolemy-lib.jar;jars/ptolemy-moml.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-ptera.jar"
	  description="A jar file containing the pt-ptera project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-ptera"/>
      <param name="jar-name" value="ptolemy-ptera"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar;jars/ptolemy-sdf.jar;jars/ptolemy-lib.jar;jars/ptolemy-moml.jar;ptolemy-fsm.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-sdf.jar"
	  description="A jar file containing the pt-sdf project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-sdf"/>
      <param name="jar-name" value="ptolemy-sdf"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar"/>
    </antcall>
  </target>

  <target name="ptolemy-sr.jar"
	  description="A jar file containing the pt-sr project.">
    <antcall target="build-jar">
      <param name="pt-projects" value="pt-sr"/>
      <param name="jar-name" value="ptolemy-sr"/>
      <param name="pt-projects-classpath" value="jars/ptolemy-core.jar;jars/ptolemy-sdf.jar"/>
    </antcall>
  </target>

</project>
