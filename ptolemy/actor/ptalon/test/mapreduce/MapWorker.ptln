/*
 * A DE domain "map worker" that maps an input key/value
 * to zero or more output key/value pairs.  It has parameter
 * keyExpression, which is the qualified name of a user-defined
 * static method that maps 
 * the output key given the input key and value, named inkey and outkey
 * respectively.  It must be an expression in the expression language.
 * Similarly, 
 * 
 *
 * @author Adam Cataldo
 */

danglingPortsOkay;

MapWorker is {
	actor buffer = ptolemy.domains.rendezvous.lib.Buffer;
	actor expression = ptolemy.actor.lib.Expression;
	
	inport inkey;
	inport invalue;
	outport outkey;
	outport outvalue;
	
	parameter mapExpression;
	parameter maxMapTokens;
	
	relation sequenceIn;	
	reader(trigger := trigger, output := sequenceIn, endOfFile := done, 
			fileOrURL := [[inputFileName]]);

	relation distributorIn
	sequenceIn(input := sequenceIn, output := 
	
	transparent relation split;
	
	distributor(input := distributorIn, output := split);
	
	/*
	 * Create map components.
	 */
	for a initially [[0]] [[a < numberOfMachines * (maxReduceTokens) / 
			(maxReduceTokens + maxMapTokens)]] {
		
	} next [[a + 1]]

	/*
	 * Create reduce components.
	 */
	for a initially [[0]] [[a < numberOfMachines - numberOfMachines * 
			(maxReduceTokens) / (maxReduceTokens + maxMapTokens)]] {
		
	} next [[a + 1]]


}
