#!/bin/sh
# Fix the copyright date
#-[Fri Feb 22 09:22:56 2002 by cxh]-
#
# The way to run this is to use $PTII/adm/bin/ptIIfiles to generate
# a list of files and then run this script on that over and over
# again until all the bogus copyrights have been found

printonly=no

while getopts nd-- opt
do
    case $opt in
	d) 	set -x;;
	n) 	printonly=yes;;
	\?)	echo "$0: Usage: $0 [-p] [-x] [filenames . . .]"
		echo " -n  Print only, do not modify any files "
		echo " -d  debug"
		exit 3;;
    esac
done
shift `expr $OPTIND - 1`


search() {
topdir=`pwd`
echo "************ $EGREPMATCH: $topdir"

for fullfile in $@
do
    cd $topdir
    echo "Now processing: $fullfile"
    egrep "$EGREPMATCH" $fullfile
    retval=$?
    if [ $retval = 0 ]; then
	# There was a difference, so we might want to check this sucker out
	file=`basename $fullfile`
	dirname=`dirname $fullfile`
	cd $dirname
	if [ -d SCCS -o -d RCS ]; then
	    echo "Error: SCCS or RCS directory"
	    exit 2
	fi
	doit
	if [ "$printonly" = "no" ]; then
	    cp /tmp/fixcopyright.tmp $file
	    if [ -d CVS ]; then
		cvs commit -m "$LOGMESSAGE" $file 
	    fi	
	else
	    echo "Would update and commit"
	fi	
    fi
done
rm -f /tmp/fixcopyright.tmp
cd $topdir
}

doit() {
    sed -e 's/\(199[0-7]\)-[ ,]/\1-2002 /' \
	$file > /tmp/fixcopyright.tmp
    diff $file /tmp/fixcopyright.tmp
}
EGREPMATCH='199[0-9]-[ ,]'
LOGMESSAGE="Fixed copyright"

search $@

doit() {
    sed 's/Copyright \(\&[^ ]*\) 1998\([ ,]\)/Copyright \1 1998-2002\2/' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH="Copyright &[^ ]* 1998[ ,]"
LOGMESSAGE="Changed copyright to 2002"

search $@

doit() {
    sed 's/\(199[0-8]\)-199[0-9]/\1-2002/' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH="199[0-8]-199[0-9]"
LOGMESSAGE="Changed copyright to 2002"

search $@

doit() {
    sed 's/Copyright (c) \(199[0-9]\)-200[01] /Copyright (c) \1-2002 /' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH='Copyright \(c\) 199[0-9]-200[01] '
LOGMESSAGE="Changed copyright to 2002"

search $@

doit() {
    sed 's/Copyright (c) 2000-2001 /Copyright (c) 2000-2002 /' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH='Copyright \(c\) 2000-2001 '
LOGMESSAGE="Changed copyright to 2002"

search $@

doit() {
    sed 's/Copyright (c) 1999 /Copyright (c) 1999-2002 /' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH="Copyright \(c\) 1999 "
LOGMESSAGE="Changed copyright to 2002"

search $@

doit() {
    sed 's/Copyright (c) 2000 /Copyright (c) 2000-2002 /' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH="Copyright \(c\) 2000 "
LOGMESSAGE="Changed copyright to 2002"

search $@


doit() {
    sed 's/Copyright (c) 2001 /Copyright (c) 2001-2002 /' \
	    $file > /tmp/fixcopyright.tmp	
    diff $file /tmp/fixcopyright.tmp	
}
EGREPMATCH="Copyright \(c\) 2001 "
LOGMESSAGE="Changed copyright to 2002"

search $@


